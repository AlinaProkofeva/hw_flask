# HW FLASK

# Quickstart

    git clone https://github.com/AlinaProkofeva/hw_flask.git
    cp .env.template .env

В .env указать переменные окружения

    docker-compose -up
    
Запустить app.py
___

** Не получилось развернуть приложение с БД (через композ с app) - запускается-то нормально, страницы с json возвращаются, все ОК, но
при адресах, подключающих БД, все падает на Base.metadata.create_all(bind=engine),
как это пофиксить так и не смогла найти, спустя несколько часов и пары десятков статей оно меня победило( Я так понимаю, там отдельные танцы 
  с миграциями нужны. Выдает (psycopg2.OperationalError) connection to server at "db" (172.28.0.2),
port 5431 failed: Connection refused
backend_app  |  Is the server running on that host and accepting TCP/IP connections?

Если в обратной связи будет, как это правильно разворачивать, буду благодарна
_____________________
# Система прав

### Регистрация пользователя 

POST http://127.0.0.1:5000/register/

    {
    "email": "t@m.ru",
    "password": "12345"
    }

**Важно!** При успешной регистрации в ответе вы получите токен для авторизации.  **Сохраните его** и передавайте в заголовках в формате:

    "token": "b1fe6e90-663b-4199-ac12-167f0efb209d"

*Передача токена в **headers** необходима для создания, редактирования и удаления объявлений
_____________________________

### Авторизация пользователя 

POST http://127.0.0.1:5000/login/

    {
    "email": "t@m.ru",
    "password": "12345"
    }

При успешной авторизации в **session** будет помощен признак **is_logged**, по которому можно закрывать доступ к желаемым url (реализовано на примере восстановления токена)
_____________________________

### Восстановление утерянного токена пользователя

GET http://127.0.0.1:5000/remember_token/

**Важно!** метод доступен только после авторизации, по **is_logged** пользователю
_____________________________________________
## Работа с объявлениями
### Просмотр объявления

GET http://127.0.0.1:5000/advertisement/1/

_________________________________________________________
### Создание объявления

POST http://127.0.0.1:5000/advertisement/

    {
    "title": "Продам третью тумбочку",
    "description": "Из ИКЕИ за 100500",
    }

*B **headers** необходимо передать token пользователя

*user_id владельца будет присвоен объявлению **автоматически** на основании переданного токена
_________________________________________________________
### Изменение объявления 

PATCH http://127.0.0.1:5000/advertisement/1/

    {
    "title": "Продам третью тумбочку",
    "description": "Из ИКЕИ за миллион",
    }

**Важно!** Изменение владельца объявления запрещено. Действие доступно только владельцу

*B **headers** необходимо передать token пользователя
_________________________________________________________
### Удаление объявления 

DELETE http://127.0.0.1:5000/advertisement/1/

*B **headers** необходимо передать token пользователя. Действие доступно только владельцу
______________________________________________________

